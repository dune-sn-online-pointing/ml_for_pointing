=========================================
3-PLANE ED TRAINING - HTCondor Job
=========================================
Job started at: Tue Nov 11 10:26:03 AM CET 2025
Running on host: b9pgpun052.cern.ch
JSON config: electron_direction/json/three_plane_focal_v6_50k.json
=========================================
Setting up environment using init.sh...
âœ“ Sourced LCG environment: LCG_106_cuda/x86_64-el9-gcc11-opt
âœ“ Added local packages to PYTHONPATH
[0;34m[INFO][0m ML for Pointing Environment
[0;34m[INFO][0m Repository: /afs/cern.ch/work/e/evilla/private/dune/refactor_ml
[0;34m[INFO][0m Python modules: /afs/cern.ch/work/e/evilla/private/dune/refactor_ml/python
[0;34m[INFO][0m Data directory: /eos/home-e/evilla/dune/sn-tps/images_test
[0;34m[INFO][0m Output directory: /eos/user/e/evilla/dune/sn-tps/neural_networks
[0;34m[INFO][0m Python version: 3.11.9
[0;32m[SUCCESS][0m TensorFlow 2.16.1 is available

GPU Information:
Tue Nov 11 10:26:26 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 570.133.20             Driver Version: 570.133.20     CUDA Version: 12.8     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA H100L-1-12C             On  |   00000000:06:00.0 Off |                   On |
| N/A   N/A    P0            N/A  /  N/A  |       1MiB /  12288MiB |     N/A      Default |
|                                         |                        |              Enabled |
+-----------------------------------------+------------------------+----------------------+

+-----------------------------------------------------------------------------------------+
| MIG devices:                                                                            |
+------------------+----------------------------------+-----------+-----------------------+
| GPU  GI  CI  MIG |                     Memory-Usage |        Vol|        Shared         |
|      ID  ID  Dev |                       BAR1-Usage | SM     Unc| CE ENC  DEC  OFA  JPG |
|                  |                                  |        ECC|                       |
|==================+==================================+===========+=======================|
|  0    0   0   0  |               1MiB / 10565MiB    | 16      0 |  1   0    1    0    1 |
|                  |                 0MiB /  4096MiB  |           |                       |
+------------------+----------------------------------+-----------+-----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+

Working directory: /afs/cern.ch/work/e/evilla/private/dune/refactor_ml
PYTHONPATH: /afs/cern.ch/work/e/evilla/private/dune/refactor_ml/local_packages/lib/python3.11/site-packages:/afs/cern.ch/work/e/evilla/private/dune/refactor_ml/python:/cvmfs/sft.cern.ch/lcg/views/LCG_106_cuda/x86_64-el9-gcc11-opt/lib/python3.11/site-packages/itk:/cvmfs/sft.cern.ch/lcg/views/LCG_106_cuda/x86_64-el9-gcc11-opt/python:/cvmfs/sft.cern.ch/lcg/views/LCG_106_cuda/x86_64-el9-gcc11-opt/lib:/cvmfs/sft.cern.ch/lcg/views/LCG_106_cuda/x86_64-el9-gcc11-opt/lib/python3.11/site-packages

Starting training...
Command: python3 electron_direction/models/train_three_plane_simple.py -j electron_direction/json/three_plane_focal_v6_50k.json

======================================================================
THREE-PLANE ELECTRON DIRECTION TRAINING (SIMPLE)
======================================================================
Config: electron_direction/json/three_plane_focal_v6_50k.json
Version: v6_focal_50k

======================================================================
STEP 1: LOADING DATA
======================================================================
Data directory: /eos/user/e/evilla/dune/sn-tps/production_es/cluster_images_nov10/
Max samples: 50000

Loading 3-plane matched data from: /eos/user/e/evilla/dune/sn-tps/production_es/cluster_images_nov10
Found 4442 X-plane files
  Processed 100/4442 files, found 4017 matched samples
  Processed 200/4442 files, found 8045 matched samples
  Processed 300/4442 files, found 12038 matched samples
  Processed 400/4442 files, found 16071 matched samples
  Processed 500/4442 files, found 20104 matched samples
  Processed 600/4442 files, found 24117 matched samples
  Processed 700/4442 files, found 28186 matched samples
  Processed 800/4442 files, found 32235 matched samples
  Processed 900/4442 files, found 36316 matched samples
  Processed 1000/4442 files, found 40357 matched samples
  Processed 1100/4442 files, found 44364 matched samples
  Processed 1200/4442 files, found 48399 matched samples

âœ“ Loaded 50000 3-plane matched samples from 1240 files
Shuffling dataset...

Data shapes:
  U images: (50000, 128, 16)
  V images: (50000, 128, 16)
  X images: (50000, 128, 16)
  Directions: (50000, 3)

Added channel dimension:
  New shapes: (50000, 128, 16, 1), (50000, 128, 16, 1), (50000, 128, 16, 1)

Train/Val split:
  Train: 40000 samples
  Val:   10000 samples

======================================================================
STEP 2: BUILDING MODEL
======================================================================
Architecture: 3-plane CNN with branches
  Conv layers per branch: 3
  Filters: 32
  Kernel size: 3
  Dense layers: 2
  Dense units: 256
  Loss: focal_loss
  Learning rate: 0.001

